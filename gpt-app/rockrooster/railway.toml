# Railway configuration for Rockrooster MCP Server
# This config builds the UI assets first, then starts the Python server

[build]
builder = "NIXPACKS"
buildCommand = "cd ui && pnpm install && pnpm run build && cd ../server && pip install -e ."

[deploy]
startCommand = "cd server && uvicorn main:app --host 0.0.0.0 --port $PORT"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[deploy.healthcheck]
path = "/health"
timeout = 100
interval = 20

# Environment variables
[[envs]]
name = "OPENAI_API_KEY"

[[envs]]
name = "SUPABASE_URL"

[[envs]]
name = "SUPABASE_KEY"

[[envs]]
name = "PYTHON_VERSION"
value = "3.12"

[[envs]]
name = "NODE_VERSION"
value = "20"

[[envs]]
name = "PORT"
value = "8000"
